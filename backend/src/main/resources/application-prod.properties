# ============================================
# Profil PRODUCTION VPS
# Usage: docker compose -f docker-compose.yml -f docker-compose.prod.yml --env-file .env.prod up -d
# ============================================

# Ecouter sur toutes les interfaces (necessaire dans Docker)
server.address=0.0.0.0

# Support reverse proxy (Traefik) - necessaire pour HTTPS et Swagger
server.forward-headers-strategy=framework

# Connexion a MySQL Docker (variables d'environnement depuis docker-compose)
spring.datasource.url=jdbc:mysql://mysql:3306/${DB_NAME}?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true&useUnicode=true&characterEncoding=UTF-8
spring.datasource.username=${DB_USERNAME}
spring.datasource.password=${DB_PASSWORD}

# JPA / Hibernate - Mode production
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false

# ======= Pas bon pour vrai serv de prod
# SQL initialization (charger data.sql si present)
spring.sql.init.mode=always
# Permet d'executer le script apres que Hibernate cree les tables
spring.jpa.defer-datasource-initialization=true

# Connection pool optimise
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=5

# Logging production
logging.level.root=WARN
logging.level.fr.mountainride.backend=INFO
logging.level.org.springframework.web=WARN

# Security headers
server.error.include-message=never
server.error.include-stacktrace=never

# JWT Configuration (depuis variables d'environnement)
jwt.secret=${JWT_SECRET}
jwt.expiration=3600000

# CORS - Mon domaine (frontend)
cors.allowed.origins=${CORS_ALLOWED_ORIGINS:https://mountainride.lucas-maiaux.fr}
